<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ä¸‰æ˜Ÿ-é æ¸¬ç³»çµ±v2.1</title>
<style>
:root {
  --primary: #00ff99;
  --primary-dark: #00cc7a;
  --secondary: #274c77;
  --secondary-light: #1a3a5f;
  --danger: #ff6666;
  --warning: #ffcc00;
  --info: #4fc3f7;
  --bg-0: #050b15;
  --bg-1: #0f1f38;
  --bg-2: #142b4d;
  --bg-3: #1a355c;
  --bg-4: #203f6e;
  --text-light: #e0f7ff;
  --text-muted: #8da1b9;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Microsoft JhengHei', sans-serif;
  background: linear-gradient(135deg, #0b1626, #051122);
  color: var(--text-light);
  line-height: 1.6;
  min-height: 100vh;
  overflow-x: hidden;
}

.container {
  max-width: 900px;
  margin: 0 auto;
  padding: 20px;
}

/* Header */
.header {
  text-align: center;
  padding: 30px 0;
  background: linear-gradient(90deg, var(--bg-0), var(--bg-1));
  border-radius: 20px;
  margin-bottom: 20px;
  position: relative;
  overflow: hidden;
  border: 1px solid rgba(0, 255, 153, 0.1);
}

.header::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, var(--primary), var(--warning));
}

.header h1 {
  font-size: 2.5rem;
  color: var(--primary);
  margin-bottom: 10px;
  text-shadow: 0 0 20px rgba(0, 255, 153, 0.3);
  font-weight: 700;
}

.subtitle {
  color: var(--text-muted);
  font-size: 1.1rem;
  letter-spacing: 0.5px;
}

/* Panels */
.panel {
  border-radius: 16px;
  padding: 24px;
  margin-bottom: 20px;
  border: 1px solid rgba(255, 255, 255, 0.05);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  position: relative;
  backdrop-filter: blur(10px);
}

.panel:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
}

.panel-0 { background: var(--bg-0); }
.panel-1 { background: var(--bg-1); }
.panel-2 { background: var(--bg-2); }
.panel-3 { background: var(--bg-3); }
.panel-4 { background: var(--bg-4); }

.panel h2 {
  font-size: 1.4rem;
  color: var(--primary);
  margin-bottom: 20px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.panel h2::before {
  content: '';
  width: 6px;
  height: 24px;
  background: var(--primary);
  border-radius: 3px;
}

/* Form Elements */
.file-input-wrapper {
  position: relative;
  margin-bottom: 15px;
}

.file-input {
  width: 100%;
  padding: 16px;
  border: 2px dashed rgba(0, 255, 153, 0.3);
  border-radius: 12px;
  background: rgba(0, 0, 0, 0.2);
  color: white;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.file-input:hover {
  border-color: var(--primary);
  background: rgba(0, 255, 153, 0.05);
}

.file-input::file-selector-button {
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  color: var(--bg-0);
  border: none;
  padding: 10px 20px;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  margin-right: 15px;
  transition: transform 0.2s ease;
}

.file-input::file-selector-button:hover {
  transform: translateY(-2px);
}

.text-input {
  width: 100%;
  padding: 16px;
  border: 2px solid rgba(255, 255, 255, 0.1);
  border-radius: 12px;
  background: rgba(0, 0, 0, 0.2);
  color: white;
  font-size: 16px;
  transition: all 0.3s ease;
  margin-bottom: 15px;
}

.text-input:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(0, 255, 153, 0.1);
}

.btn {
  width: 100%;
  padding: 16px 24px;
  border: none;
  border-radius: 12px;
  background: linear-gradient(135deg, var(--secondary), var(--secondary-light));
  color: white;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
  letter-spacing: 0.5px;
}

.btn::after {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
  transition: left 0.6s ease;
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(39, 76, 119, 0.4);
}

.btn:hover::after {
  left: 100%;
}

.btn:active {
  transform: translateY(0);
}

.btn-primary {
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
}

.btn-group {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
  margin-top: 15px;
}

/* Boxes */
.box {
  background: rgba(0, 0, 0, 0.3);
  border-radius: 12px;
  padding: 20px;
  margin-top: 20px;
  border: 1px solid rgba(255, 255, 255, 0.05);
  transition: all 0.3s ease;
}

.box:hover {
  border-color: rgba(0, 255, 153, 0.1);
}

.box-title {
  color: var(--primary);
  font-size: 1.1rem;
  margin-bottom: 15px;
  display: flex;
  align-items: center;
  gap: 8px;
  font-weight: 600;
}

/* Numbers Display */
.numbers-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
  gap: 12px;
  margin: 15px 0;
}

.number-ball {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.4rem;
  font-weight: bold;
  background: linear-gradient(135deg, var(--secondary), var(--secondary-light));
  color: white;
  transition: all 0.3s ease;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
  cursor: pointer;
  user-select: none;
}

.number-ball.hot {
  background: linear-gradient(135deg, #ff6666, #cc0000);
}

.number-ball.cold {
  background: linear-gradient(135deg, var(--info), #0288d1);
}

.number-ball.warm {
  background: linear-gradient(135deg, #ff9900, #cc6600);
}

.number-ball.missed {
  background: linear-gradient(135deg, #ffcc00, #cc9900);
}

.number-ball.selected {
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  transform: scale(1.1);
  box-shadow: 0 0 20px rgba(0, 255, 153, 0.5);
}

.number-ball:hover {
  transform: scale(1.1) rotate(5deg);
  box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
}

/* Stats */
.stats-row {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 15px;
  margin: 15px 0;
}

.stat-item {
  background: rgba(255, 255, 255, 0.05);
  padding: 15px;
  border-radius: 10px;
  text-align: center;
  transition: all 0.3s ease;
}

.stat-item:hover {
  background: rgba(255, 255, 255, 0.08);
  transform: translateY(-2px);
}

.stat-label {
  color: var(--text-muted);
  font-size: 0.9rem;
  margin-bottom: 8px;
  font-weight: 500;
}

.stat-value {
  color: var(--primary);
  font-size: 1.4rem;
  font-weight: bold;
}

/* Status Messages */
.status {
  padding: 12px 16px;
  border-radius: 8px;
  margin: 10px 0;
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 0.95rem;
  border-left: 4px solid transparent;
}

.status.success {
  background: rgba(0, 255, 153, 0.1);
  border-left-color: var(--primary);
  color: var(--primary);
}

.status.warning {
  background: rgba(255, 204, 0, 0.1);
  border-left-color: var(--warning);
  color: var(--warning);
}

.status.error {
  background: rgba(255, 102, 102, 0.1);
  border-left-color: var(--danger);
  color: var(--danger);
}

.status.info {
  background: rgba(79, 195, 247, 0.1);
  border-left-color: var(--info);
  color: var(--info);
}

/* Loading Animation */
.loading {
  display: none;
  text-align: center;
  padding: 30px;
}

.spinner {
  width: 50px;
  height: 50px;
  border: 4px solid rgba(0, 255, 153, 0.1);
  border-top: 4px solid var(--primary);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 0 auto 20px;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Progress Bar */
.progress-bar {
  width: 100%;
  height: 6px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 3px;
  overflow: hidden;
  margin: 15px 0;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--primary), var(--primary-dark));
  border-radius: 3px;
  transition: width 0.3s ease;
}

/* Tooltip */
.tooltip {
  position: relative;
  display: inline-block;
}

.tooltip .tooltip-text {
  visibility: hidden;
  width: 200px;
  background: var(--bg-1);
  color: var(--text-light);
  text-align: center;
  padding: 8px;
  border-radius: 6px;
  position: absolute;
  z-index: 1000;
  bottom: 125%;
  left: 50%;
  transform: translateX(-50%);
  opacity: 0;
  transition: opacity 0.3s;
  font-size: 0.9rem;
  border: 1px solid rgba(255, 255, 255, 0.1);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

.tooltip:hover .tooltip-text {
  visibility: visible;
  opacity: 1;
}

/* Tabs */
.tabs {
  display: flex;
  gap: 5px;
  margin-bottom: 20px;
  background: rgba(0, 0, 0, 0.2);
  padding: 5px;
  border-radius: 10px;
}

.tab {
  flex: 1;
  padding: 10px;
  text-align: center;
  background: transparent;
  border: none;
  color: var(--text-muted);
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  font-weight: 500;
}

.tab.active {
  background: rgba(0, 255, 153, 0.2);
  color: var(--primary);
}

/* Footer */
.footer {
  text-align: center;
  padding: 20px;
  color: var(--text-muted);
  font-size: 0.9rem;
  margin-top: 40px;
  border-top: 1px solid rgba(255, 255, 255, 0.05);
}

.footer a {
  color: var(--primary);
  text-decoration: none;
  transition: color 0.3s ease;
}

.footer a:hover {
  color: var(--text-light);
  text-decoration: underline;
}

/* Responsive */
@media (max-width: 768px) {
  .container {
    padding: 15px;
  }
  
  .header h1 {
    font-size: 2rem;
  }
  
  .panel {
    padding: 20px;
  }
  
  .numbers-grid {
    grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
    gap: 10px;
  }
  
  .number-ball {
    width: 50px;
    height: 50px;
    font-size: 1.2rem;
  }
  
  .stats-row {
    grid-template-columns: 1fr 1fr;
  }
  
  .btn-group {
    grid-template-columns: 1fr;
  }
}

@media (max-width: 480px) {
  .stats-row {
    grid-template-columns: 1fr;
  }
  
  .header h1 {
    font-size: 1.8rem;
  }
}
</style>
</head>
<body>

<div class="container">
  <!-- Header -->
  <div class="header">
    <h1>ğŸ¯ ä¸‰æ˜Ÿ-é æ¸¬ç³»çµ± v2.1</h1>
    <div class="subtitle">æ™ºèƒ½é æ¸¬åˆ†æç³»çµ± | åŸºæ–¼æ­·å²æ•¸æ“šçš„å¤šç¶­åº¦åˆ†æ</div>
  </div>

  <!-- Panel 1ï¼šæ•¸æ“šå°å…¥ -->
  <div class="panel panel-1">
    <h2>ğŸ“Š æ•¸æ“šå°å…¥å±¤</h2>
    <div class="file-input-wrapper">
      <input type="file" id="csvInput" class="file-input" accept=".csv">
    </div>
    <div class="status info">æ”¯æŒCSVæ ¼å¼ï¼Œéœ€åŒ…å«æ—¥æœŸåŠ5å€‹è™Ÿç¢¼æ¬„ä½</div>
    <div id="csvInfo"></div>
    <div id="basicStats" style="display: none;"></div>
  </div>

  <!-- Panel Aï¼šæ™ºèƒ½åˆ†æ -->
  <div class="panel panel-2">
    <h2>ğŸ” æ™ºèƒ½åˆ†æå±¤</h2>
    <div class="btn-group">
      <button class="btn btn-primary" onclick="runFullAnalysis()">
        <span class="icon">ğŸ“ˆ</span> å®Œæ•´åˆ†æ
      </button>
      <button class="btn" onclick="runQuickAnalysis()">
        <span class="icon">âš¡</span> å¿«é€Ÿåˆ†æ
      </button>
    </div>
    
    <div class="loading" id="loadingA">
      <div class="spinner"></div>
      <div>æ­£åœ¨åˆ†ææ•¸æ“š...</div>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
    </div>
    
    <div id="panelA" style="display: none;">
      <div class="tabs" id="analysisTabs">
        <button class="tab active" onclick="switchAnalysisTab('frequency')">é »ç‡åˆ†æ</button>
        <button class="tab" onclick="switchAnalysisTab('trend')">è¶¨å‹¢åˆ†æ</button>
        <button class="tab" onclick="switchAnalysisTab('patterns')">æ¨¡å¼åˆ†æ</button>
      </div>
      <div id="analysisContent"></div>
    </div>
  </div>

  <!-- Panel Bï¼šçµ„åˆé©—è­‰ -->
  <div class="panel panel-3">
    <h2>âœ… çµ„åˆé©—è­‰å±¤</h2>
    <div class="btn-group">
      <div>
        <input type="text" id="verifyInput" class="text-input" 
               placeholder="è¼¸å…¥5å€‹è™Ÿç¢¼ï¼Œå¦‚ï¼š1 2 16 33 35">
        <button class="btn btn-primary" onclick="runVerify()">åˆ†æçµ„åˆ</button>
      </div>
      <div>
        <button class="btn" onclick="generateRandomCombination()">éš¨æ©Ÿç”Ÿæˆ</button>
        <button class="btn" onclick="clearVerification()">æ¸…é™¤</button>
      </div>
    </div>
    
    <div id="panelB" style="display: none;"></div>
  </div>

  <!-- Panel Cï¼šé æ¸¬ç”Ÿæˆ -->
  <div class="panel panel-4">
    <h2>ğŸ¯ é æ¸¬ç”Ÿæˆå±¤</h2>
    <div class="btn-group">
      <button class="btn btn-primary" onclick="generateSmartPrediction()">
        <span class="icon">ğŸ¤–</span> æ™ºèƒ½é æ¸¬
      </button>
      <button class="btn" onclick="generateTrendPrediction()">
        <span class="icon">ğŸ“Š</span> è¶¨å‹¢é æ¸¬
      </button>
      <button class="btn" onclick="generateBalancedPrediction()">
        <span class="icon">âš–ï¸</span> å¹³è¡¡é æ¸¬
      </button>
    </div>
    
    <div class="loading" id="loadingC">
      <div class="spinner"></div>
      <div>æ­£åœ¨ç”Ÿæˆé æ¸¬...</div>
    </div>
    
    <div id="panelC" style="display: none;">
      <div id="predictionResults"></div>
    </div>
  </div>

  <!-- Panel Dï¼šé æ¸¬é‚è¼¯èªªæ˜ -->
  <div class="panel panel-0">
    <h2 id="toggleLogic" style="cursor: pointer; display: flex; justify-content: space-between; align-items: center;">
      <span>ğŸ§  é æ¸¬é‚è¼¯èªªæ˜</span>
      <span style="font-size: 1rem;">â–¼</span>
    </h2>
    <div id="logicContent" style="display: none;">
      <div class="status info">
        <strong>ç‰ˆæœ¬ 2.1 æ›´æ–°ï¼š</strong> æ–°å¢å¤šç¨®é æ¸¬ç®—æ³•ã€å³æ™‚æ•¸æ“šè¦–è¦ºåŒ–ã€è™Ÿç¢¼æ¨è–¦ç³»çµ±
      </div>
      
      <div style="margin: 20px 0;">
        <h3 style="color: var(--primary); margin-bottom: 10px;">ğŸ“ˆ æ ¸å¿ƒç®—æ³•</h3>
        <div class="stats-row">
          <div class="stat-item">
            <div class="stat-label">é »ç‡æ¬Šé‡</div>
            <div class="stat-value">40%</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">éºæ¼åˆ†æ</div>
            <div class="stat-value">30%</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">è¶¨å‹¢é æ¸¬</div>
            <div class="stat-value">20%</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">éš¨æ©Ÿå› å­</div>
            <div class="stat-value">10%</div>
          </div>
        </div>
      </div>
      
      <div style="margin: 20px 0;">
        <h3 style="color: var(--primary); margin-bottom: 10px;">ğŸ¯ é æ¸¬ç­–ç•¥</h3>
        <ul style="padding-left: 20px; color: var(--text-muted); line-height: 1.8;">
          <li><strong>æ™ºèƒ½é æ¸¬ï¼š</strong> ç¶œåˆè€ƒæ…®é »ç‡ã€éºæ¼ã€ç†±å†·è™Ÿã€è¶¨å‹¢ç·š</li>
          <li><strong>è¶¨å‹¢é æ¸¬ï¼š</strong> å°ˆæ³¨æ–¼è¿‘æœŸèµ°å‹¢å’Œä¸Šå‡è¶¨å‹¢è™Ÿç¢¼</li>
          <li><strong>å¹³è¡¡é æ¸¬ï¼š</strong> ç¢ºä¿å¥‡å¶ã€å¤§å°ã€å’Œå€¼ç­‰çµ±è¨ˆå¹³è¡¡</li>
          <li><strong>éš¨æ©Ÿç”Ÿæˆï¼š</strong> åœ¨çµ±è¨ˆè¦å‰‡å…§éš¨æ©Ÿç”¢ç”Ÿçµ„åˆ</li>
        </ul>
      </div>
      
      <div class="status warning">
        âš ï¸ å…è²¬è²æ˜ï¼šæœ¬ç³»çµ±åƒ…ä¾›å¨›æ¨‚åƒè€ƒï¼Œä¸å…·ä»»ä½•é æ¸¬ä¿è­‰åŠŸèƒ½ã€‚å½©ç¥¨é–‹çç‚ºéš¨æ©Ÿäº‹ä»¶ï¼Œè«‹ç†æ€§åƒèˆ‡ã€‚
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div class="footer">
    <p>Â© 2023 ä¸‰æ˜Ÿé æ¸¬ç³»çµ± v2.1 | æ•¸æ“šåˆ†æå¼•æ“ | æœ€å¾Œæ›´æ–°: 2023-11</p>
    <p>âš ï¸ æœ¬ç³»çµ±åŸºæ–¼æ­·å²æ•¸æ“šåˆ†æï¼Œåƒ…ä¾›å¨›æ¨‚åƒè€ƒã€‚è«‹ç†æ€§åƒèˆ‡ï¼Œé‡åŠ›è€Œè¡Œã€‚</p>
  </div>
</div>

<script>
// å…¨å±€æ•¸æ“šå­˜å„²
let data = [];
let analysisCache = null;
let currentAnalysisTab = 'frequency';

// åˆå§‹åŒ–é é¢
document.addEventListener('DOMContentLoaded', function() {
  initializeFileDrop();
  loadSampleData();
});

// åˆå§‹åŒ–æ–‡ä»¶æ‹–æ”¾
function initializeFileDrop() {
  const panel1 = document.querySelector('.panel-1');
  const fileInput = document.getElementById('csvInput');
  
  panel1.addEventListener('dragover', function(e) {
    e.preventDefault();
    panel1.style.borderColor = 'var(--primary)';
    panel1.style.transform = 'scale(1.02)';
  });
  
  panel1.addEventListener('dragleave', function() {
    panel1.style.borderColor = 'rgba(255, 255, 255, 0.05)';
    panel1.style.transform = 'scale(1)';
  });
  
  panel1.addEventListener('drop', function(e) {
    e.preventDefault();
    panel1.style.borderColor = 'rgba(255, 255, 255, 0.05)';
    panel1.style.transform = 'scale(1)';
    
    if (e.dataTransfer.files.length) {
      fileInput.files = e.dataTransfer.files;
      fileInput.dispatchEvent(new Event('change'));
    }
  });
  
  fileInput.addEventListener('change', handleFileUpload);
}

// è™•ç†æ–‡ä»¶ä¸Šå‚³
function handleFileUpload(e) {
  const file = e.target.files[0];
  if (!file) return;
  
  showStatus('csvInfo', 'æ­£åœ¨è®€å–æ–‡ä»¶...', 'info');
  
  const reader = new FileReader();
  reader.onload = function(event) {
    try {
      parseCSVData(event.target.result);
      showStatus('csvInfo', `âœ… å·²è¼‰å…¥ ${data.length} æœŸæ•¸æ“š`, 'success');
      displayBasicStats();
    } catch (error) {
      showStatus('csvInfo', `âŒ è§£æéŒ¯èª¤: ${error.message}`, 'error');
    }
  };
  
  reader.onerror = function() {
    showStatus('csvInfo', 'âŒ æ–‡ä»¶è®€å–å¤±æ•—', 'error');
  };
  
  reader.readAsText(file, 'UTF-8');
}

// è§£æCSVæ•¸æ“š
function parseCSVData(content) {
  const lines = content.trim().split(/\r?\n/);
  data = [];
  
  lines.forEach((line, index) => {
    if (index === 0 || line.trim() === '') return;
    
    const parts = line.split(/[,ï¼Œ\s]+/);
    if (parts.length >= 6) {
      const date = parts[0].trim();
      const numbers = parts.slice(1, 6)
        .map(num => parseInt(num.trim()))
        .filter(n => !isNaN(n) && n >= 1 && n <= 39);
      
      if (numbers.length === 5 && new Set(numbers).size === 5) {
        data.push({
          date: date,
          numbers: numbers.sort((a, b) => a - b),
          index: data.length
        });
      }
    }
  });
  
  if (data.length === 0) {
    throw new Error('æœªæ‰¾åˆ°æœ‰æ•ˆæ•¸æ“šï¼Œè«‹æª¢æŸ¥æ ¼å¼');
  }
}

// è¼‰å…¥ç¤ºä¾‹æ•¸æ“š
function loadSampleData() {
  // ç”Ÿæˆç¤ºä¾‹æ•¸æ“š
  const sampleData = [];
  const today = new Date();
  
  for (let i = 0; i < 100; i++) {
    const date = new Date(today);
    date.setDate(date.getDate() - i);
    
    const numbers = generateUniqueNumbers(5, 1, 39);
    sampleData.push({
      date: date.toISOString().split('T')[0],
      numbers: numbers.sort((a, b) => a - b),
      index: i
    });
  }
  
  data = sampleData;
  showStatus('csvInfo', 'ğŸ“‹ ç¤ºä¾‹æ•¸æ“šå·²è¼‰å…¥ (100æœŸ)', 'info');
  displayBasicStats();
}

// ç”Ÿæˆå”¯ä¸€æ•¸å­—
function generateUniqueNumbers(count, min, max) {
  const numbers = new Set();
  while (numbers.size < count) {
    numbers.add(Math.floor(Math.random() * (max - min + 1)) + min);
  }
  return Array.from(numbers);
}

// é¡¯ç¤ºåŸºæœ¬çµ±è¨ˆ
function displayBasicStats() {
  if (data.length === 0) return;
  
  const stats = calculateBasicStats();
  const container = document.getElementById('basicStats');
  
  container.style.display = 'grid';
  container.innerHTML = `
    <div class="stat-item">
      <div class="stat-label">ç¸½æœŸæ•¸</div>
      <div class="stat-value">${stats.totalDraws}</div>
    </div>
    <div class="stat-item">
      <div class="stat-label">æ•¸æ“šç¯„åœ</div>
      <div class="stat-value">${stats.dateRange}</div>
    </div>
    <div class="stat-item">
      <div class="stat-label">ç†±é–€è™Ÿç¢¼</div>
      <div class="stat-value" style="color:var(--danger)">${stats.hotNumbers.slice(0, 3).join(', ')}</div>
    </div>
    <div class="stat-item">
      <div class="stat-label">å†·é–€è™Ÿç¢¼</div>
      <div class="stat-value" style="color:var(--info)">${stats.coldNumbers.slice(0, 3).join(', ')}</div>
    </div>
  `;
}

// è¨ˆç®—åŸºæœ¬çµ±è¨ˆ
function calculateBasicStats() {
  const frequency = {};
  const dates = [];
  
  data.forEach(draw => {
    draw.numbers.forEach(num => {
      frequency[num] = (frequency[num] || 0) + 1;
    });
    dates.push(draw.date);
  });
  
  const allNumbers = Array.from({length: 39}, (_, i) => i + 1);
  const sortedNumbers = allNumbers.sort((a, b) => (frequency[b] || 0) - (frequency[a] || 0));
  
  return {
    totalDraws: data.length,
    dateRange: `${dates[dates.length-1]} ~ ${dates[0]}`,
    hotNumbers: sortedNumbers.slice(0, 10),
    coldNumbers: sortedNumbers.slice(-10).reverse(),
    frequency
  };
}

// åŸ·è¡Œå®Œæ•´åˆ†æ
function runFullAnalysis() {
  if (!validateData()) return;
  
  showLoading('loadingA', true);
  animateProgress(1000);
  
  setTimeout(() => {
    analysisCache = calculateAdvancedStats();
    displayAnalysisResults();
    showLoading('loadingA', false);
  }, 1000);
}

// åŸ·è¡Œå¿«é€Ÿåˆ†æ
function runQuickAnalysis() {
  if (!validateData()) return;
  
  showLoading('loadingA', true);
  animateProgress(500);
  
  setTimeout(() => {
    analysisCache = calculateQuickStats();
    displayAnalysisResults();
    showLoading('loadingA', false);
  }, 500);
}

// åˆ‡æ›åˆ†ææ¨™ç±¤é 
function switchAnalysisTab(tab) {
  currentAnalysisTab = tab;
  
  // æ›´æ–°æ¨™ç±¤ç‹€æ…‹
  document.querySelectorAll('#analysisTabs .tab').forEach(t => {
    t.classList.remove('active');
  });
  event.target.classList.add('active');
  
  // é¡¯ç¤ºå°æ‡‰å…§å®¹
  displayAnalysisTab(tab);
}

// é¡¯ç¤ºåˆ†ææ¨™ç±¤é å…§å®¹
function displayAnalysisTab(tab) {
  if (!analysisCache) return;
  
  const container = document.getElementById('analysisContent');
  let content = '';
  
  switch(tab) {
    case 'frequency':
      content = generateFrequencyTab();
      break;
    case 'trend':
      content = generateTrendTab();
      break;
    case 'patterns':
      content = generatePatternsTab();
      break;
  }
  
  container.innerHTML = content;
  attachNumberClickEvents();
}

// ç”Ÿæˆé »ç‡åˆ†æå…§å®¹
function generateFrequencyTab() {
  const { frequency, hotNumbers, coldNumbers, warmNumbers } = analysisCache;
  
  return `
    <div class="box">
      <div class="box-title">ğŸ”¥ ç†±é–€è™Ÿç¢¼ (å‰10)</div>
      <div class="numbers-grid">
        ${hotNumbers.map(num => `
          <div class="number-ball hot tooltip" 
               onclick="selectNumber(${num})"
               data-number="${num}">
            ${num}
            <span class="tooltip-text">å‡ºç¾ ${frequency[num]} æ¬¡<br>é »ç‡: ${(frequency[num]/data.length*100).toFixed(1)}%</span>
          </div>
        `).join('')}
      </div>
    </div>
    
    <div class="box">
      <div class="box-title">ğŸŒ¡ï¸ æº«è™Ÿè™Ÿç¢¼</div>
      <div class="numbers-grid">
        ${warmNumbers.map(num => `
          <div class="number-ball warm tooltip"
               onclick="selectNumber(${num})"
               data-number="${num}">
            ${num}
            <span class="tooltip-text">å‡ºç¾ ${frequency[num]} æ¬¡</span>
          </div>
        `).join('')}
      </div>
    </div>
    
    <div class="box">
      <div class="box-title">â„ï¸ å†·é–€è™Ÿç¢¼ (å¾Œ10)</div>
      <div class="numbers-grid">
        ${coldNumbers.map(num => `
          <div class="number-ball cold tooltip"
               onclick="selectNumber(${num})"
               data-number="${num}">
            ${num}
            <span class="tooltip-text">å‡ºç¾ ${frequency[num] || 0} æ¬¡</span>
          </div>
        `).join('')}
      </div>
    </div>
    
    <div class="box">
      <div class="box-title">ğŸ“Š é »ç‡åˆ†ä½ˆ</div>
      <div class="stats-row">
        <div class="stat-item">
          <div class="stat-label">æœ€é«˜é »ç‡</div>
          <div class="stat-value">${hotNumbers[0]} (${frequency[hotNumbers[0]]}æ¬¡)</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">å¹³å‡å‡ºç¾</div>
          <div class="stat-value">${(data.length * 5 / 39).toFixed(1)}æ¬¡</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">æœªå‡ºç¾</div>
          <div class="stat-value">${Object.values(frequency).filter(f => f === 0).length}å€‹</div>
        </div>
      </div>
    </div>
  `;
}

// ç”Ÿæˆè¶¨å‹¢åˆ†æå…§å®¹
function generateTrendTab() {
  const { trendNumbers, lastSeen } = analysisCache;
  
  return `
    <div class="box">
      <div class="box-title">ğŸ“ˆ ä¸Šå‡è¶¨å‹¢è™Ÿç¢¼</div>
      <div class="numbers-grid">
        ${trendNumbers.slice(0, 15).map(item => `
          <div class="number-ball tooltip"
               onclick="selectNumber(${item.num})"
               data-number="${item.num}">
            ${item.num}
            <span class="tooltip-text">
              æœ€è¿‘${item.last5}æœŸå‡ºç¾ ${item.freq5} æ¬¡<br>
              ç¸½å…±å‡ºç¾ ${item.total} æ¬¡<br>
              éºæ¼: ${item.missed} æœŸ
            </span>
          </div>
        `).join('')}
      </div>
    </div>
    
    <div class="box">
      <div class="box-title">â° éºæ¼åˆ†æ</div>
      <div class="numbers-grid">
        ${Array.from({length: 39}, (_, i) => i + 1)
          .filter(num => lastSeen[num] > 10)
          .sort((a, b) => lastSeen[b] - lastSeen[a])
          .slice(0, 15)
          .map(num => `
            <div class="number-ball missed tooltip"
                 onclick="selectNumber(${num})"
                 data-number="${num}">
              ${num}
              <span class="tooltip-text">å·²éºæ¼ ${lastSeen[num]} æœŸ</span>
            </div>
          `).join('')}
      </div>
    </div>
  `;
}

// ç”Ÿæˆæ¨¡å¼åˆ†æå…§å®¹
function generatePatternsTab() {
  const { sumStats, oddEvenStats, sizeStats } = analysisCache;
  
  return `
    <div class="box">
      <div class="box-title">ğŸ§® å’Œå€¼çµ±è¨ˆ</div>
      <div class="stats-row">
        <div class="stat-item">
          <div class="stat-label">å¹³å‡å’Œå€¼</div>
          <div class="stat-value">${sumStats.avg}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">æœ€å°å’Œå€¼</div>
          <div class="stat-value">${sumStats.min}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">æœ€å¤§å’Œå€¼</div>
          <div class="stat-value">${sumStats.max}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">å¸¸è¦‹ç¯„åœ</div>
          <div class="stat-value">${sumStats.commonRange}</div>
        </div>
      </div>
      <div class="status info">ğŸ’¡ å»ºè­°å’Œå€¼ç¯„åœ: ${sumStats.suggestedRange}</div>
    </div>
    
    <div class="box">
      <div class="box-title">âš–ï¸ å¥‡å¶åˆ†ä½ˆ</div>
      <div class="stats-row">
        <div class="stat-item">
          <div class="stat-label">å¹³å‡å¥‡æ•¸</div>
          <div class="stat-value">${oddEvenStats.avgOdd}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">å¸¸è¦‹æ¯”ä¾‹</div>
          <div class="stat-value">${oddEvenStats.commonPattern}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">å…¨å¥‡/å…¨å¶</div>
          <div class="stat-value">${oddEvenStats.extremePatterns}</div>
        </div>
      </div>
    </div>
    
    <div class="box">
      <div class="box-title">ğŸ“ å¤§å°åˆ†ä½ˆ</div>
      <div class="stats-row">
        <div class="stat-item">
          <div class="stat-label">å¹³å‡å¤§æ•¸</div>
          <div class="stat-value">${sizeStats.avgLarge}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">å¸¸è¦‹åˆ†ä½ˆ</div>
          <div class="stat-value">${sizeStats.commonPattern}</div>
        </div>
      </div>
    </div>
  `;
}

// è¨ˆç®—é€²éšçµ±è¨ˆ
function calculateAdvancedStats() {
  const frequency = {};
  const lastSeen = {};
  const recentFrequency = {}; // æœ€è¿‘20æœŸ
  const sums = [];
  const oddEvenCounts = [];
  const sizeCounts = [];
  
  // æ”¶é›†æ•¸æ“š
  data.forEach((draw, index) => {
    // é »ç‡å’Œæœ€å¾Œå‡ºç¾ä½ç½®
    draw.numbers.forEach(num => {
      frequency[num] = (frequency[num] || 0) + 1;
      lastSeen[num] = index;
      
      // æœ€è¿‘20æœŸé »ç‡
      if (index >= data.length - 20) {
        recentFrequency[num] = (recentFrequency[num] || 0) + 1;
      }
    });
    
    // å’Œå€¼
    const sum = draw.numbers.reduce((a, b) => a + b, 0);
    sums.push(sum);
    
    // å¥‡å¶æ¯”
    const oddCount = draw.numbers.filter(n => n % 2 === 1).length;
    oddEvenCounts.push(oddCount);
    
    // å¤§å°æ¯” (å¤§æ•¸: 20-39)
    const largeCount = draw.numbers.filter(n => n >= 20).length;
    sizeCounts.push(largeCount);
  });
  
  // ç†±é–€è™Ÿç¢¼
  const allNumbers = Array.from({length: 39}, (_, i) => i + 1);
  const hotNumbers = allNumbers
    .sort((a, b) => (frequency[b] || 0) - (frequency[a] || 0))
    .slice(0, 10);
  
  // å†·é–€è™Ÿç¢¼
  const coldNumbers = allNumbers
    .sort((a, b) => (frequency[a] || 0) - (frequency[b] || 0))
    .slice(0, 10);
  
  // æº«è™Ÿè™Ÿç¢¼ (å‡ºç¾é »ç‡ä¸­ç­‰)
  const warmNumbers = allNumbers
    .filter(num => {
      const freq = frequency[num] || 0;
      const avgFreq = data.length * 5 / 39;
      return Math.abs(freq - avgFreq) <= 2;
    })
    .slice(0, 10);
  
  // è¶¨å‹¢è™Ÿç¢¼ (æœ€è¿‘å‡ºç¾é »ç‡å¢åŠ )
  const trendNumbers = allNumbers
    .map(num => {
      const total = frequency[num] || 0;
      const recent = recentFrequency[num] || 0;
      const last5Index = Math.max(0, data.length - 5);
      const freq5 = data.slice(last5Index).filter(d => d.numbers.includes(num)).length;
      
      return {
        num,
        total,
        recent,
        freq5,
        last5: 5,
        missed: data.length - (lastSeen[num] || 0)
      };
    })
    .filter(item => item.recent > 0)
    .sort((a, b) => b.recent - a.recent)
    .slice(0, 15);
  
  // å’Œå€¼çµ±è¨ˆ
  const sumStats = {
    min: Math.min(...sums),
    max: Math.max(...sums),
    avg: Math.round(sums.reduce((a, b) => a + b, 0) / sums.length),
    commonRange: getCommonRange(sums),
    suggestedRange: `${Math.round(Math.min(...sums) * 0.7 + Math.max(...sums) * 0.3)}-${Math.round(Math.min(...sums) * 0.3 + Math.max(...sums) * 0.7)}`
  };
  
  // å¥‡å¶çµ±è¨ˆ
  const oddEvenStats = {
    avgOdd: (oddEvenCounts.reduce((a, b) => a + b, 0) / oddEvenCounts.length).toFixed(1),
    commonPattern: getMostCommonPattern(oddEvenCounts),
    extremePatterns: countExtremePatterns(oddEvenCounts)
  };
  
  // å¤§å°çµ±è¨ˆ
  const sizeStats = {
    avgLarge: (sizeCounts.reduce((a, b) => a + b, 0) / sizeCounts.length).toFixed(1),
    commonPattern: getMostCommonPattern(sizeCounts)
  };
  
  return {
    frequency,
    lastSeen,
    hotNumbers,
    coldNumbers,
    warmNumbers,
    trendNumbers,
    sumStats,
    oddEvenStats,
    sizeStats,
    recentFrequency
  };
}

// è¨ˆç®—å¿«é€Ÿçµ±è¨ˆ
function calculateQuickStats() {
  const frequency = {};
  
  data.forEach(draw => {
    draw.numbers.forEach(num => {
      frequency[num] = (frequency[num] || 0) + 1;
    });
  });
  
  return { frequency };
}

// é¡¯ç¤ºåˆ†æçµæœ
function displayAnalysisResults() {
  const container = document.getElementById('panelA');
  container.style.display = 'block';
  displayAnalysisTab(currentAnalysisTab);
}

// é©—è­‰çµ„åˆ
function runVerify() {
  const input = document.getElementById('verifyInput').value.trim();
  if (!input) {
    alert('è«‹è¼¸å…¥è¦é©—è­‰çš„è™Ÿç¢¼çµ„åˆ');
    return;
  }
  
  const numbers = input.split(/\s+/)
    .map(num => parseInt(num.trim()))
    .filter(n => !isNaN(n));
  
  if (!validateCombination(numbers)) return;
  
  const container = document.getElementById('panelB');
  container.style.display = 'block';
  container.innerHTML = generateVerificationResults(numbers);
}

// ç”Ÿæˆé©—è­‰çµæœ
function generateVerificationResults(numbers) {
  if (!analysisCache) {
    analysisCache = calculateAdvancedStats();
  }
  
  const sortedNumbers = [...numbers].sort((a, b) => a - b);
  const stats = analysisCache;
  
  // è¨ˆç®—çµ„åˆç‰¹æ€§
  const oddCount = numbers.filter(n => n % 2 === 1).length;
  const largeCount = numbers.filter(n => n >= 20).length;
  const sum = numbers.reduce((a, b) => a + b, 0);
  const span = Math.max(...numbers) - Math.min(...numbers);
  const avg = sum / 5;
  
  // è©•ä¼°çµ„åˆ
  const score = evaluateCombination(numbers, stats);
  const rating = getRating(score);
  
  // è™Ÿç¢¼è©³ç´°åˆ†æ
  const numberAnalysis = numbers.map(num => analyzeNumber(num, stats));
  
  return `
    <div class="box">
      <div class="box-title">ğŸ“‹ çµ„åˆé©—è­‰çµæœ</div>
      
      <div class="numbers-grid">
        ${sortedNumbers.map(num => `
          <div class="number-ball ${getNumberClass(num, stats)}">${num}</div>
        `).join('')}
      </div>
      
      <div class="status ${rating.status}">
        <strong>${rating.title}</strong><br>
        ${rating.description}
      </div>
      
      <div class="stats-row">
        <div class="stat-item">
          <div class="stat-label">è©•åˆ†</div>
          <div class="stat-value" style="font-size: 2rem; color: ${rating.color}">${score}/100</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">å¥‡å¶</div>
          <div class="stat-value">${oddCount}å¥‡${5-oddCount}å¶</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">å¤§å°</div>
          <div class="stat-value">${largeCount}å¤§${5-largeCount}å°</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">ç¸½å’Œ</div>
          <div class="stat-value">${sum}</div>
        </div>
      </div>
    </div>
    
    <div class="box">
      <div class="box-title">ğŸ” è©³ç´°åˆ†æ</div>
      ${numberAnalysis.map(item => `
        <div class="stat-item" style="text-align: left; margin-bottom: 10px;">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
              <strong style="color: var(--primary);">è™Ÿç¢¼ ${item.num}</strong>
              <span style="color: ${item.statusColor}; font-size: 0.9rem; margin-left: 10px;">
                ${item.status}
              </span>
            </div>
            <div style="font-size: 0.9rem; color: var(--text-muted);">
              å‡ºç¾ ${item.freq} æ¬¡ | éºæ¼ ${item.missed} æœŸ
            </div>
          </div>
          <div style="font-size: 0.9rem; color: var(--text-muted); margin-top: 5px;">
            é »ç‡: ${item.freqRatio}% | è©•åˆ†: ${item.score}/20
          </div>
        </div>
      `).join('')}
    </div>
    
    <div class="box">
      <div class="box-title">ğŸ’¡ æ”¹é€²å»ºè­°</div>
      <div class="status info">
        ${generateImprovementSuggestions(numbers, stats)}
      </div>
    </div>
  `;
}

// è©•ä¼°çµ„åˆ
function evaluateCombination(numbers, stats) {
  let score = 0;
  
  // 1. è™Ÿç¢¼ç†±åº¦ (0-40åˆ†)
  numbers.forEach(num => {
    const freq = stats.frequency[num] || 0;
    const avgFreq = data.length * 5 / 39;
    
    if (Math.abs(freq - avgFreq) <= 2) score += 8; // æº«è™Ÿ
    else if (freq > avgFreq) score += 6; // ç†±è™Ÿ
    else score += 4; // å†·è™Ÿ
  });
  
  // 2. éºæ¼åˆ†æ (0-20åˆ†)
  numbers.forEach(num => {
    const missed = data.length - (stats.lastSeen[num] || 0);
    if (missed >= 5 && missed <= 15) score += 4; // é©ç•¶éºæ¼
    else if (missed < 5) score += 2; // å‰›å‡ºé
    else score += 3; // é•·æœŸéºæ¼
  });
  
  // 3. å¥‡å¶å¹³è¡¡ (0-20åˆ†)
  const oddCount = numbers.filter(n => n % 2 === 1).length;
  const expectedOdd = parseFloat(stats.oddEvenStats.avgOdd);
  const oddDiff = Math.abs(oddCount - expectedOdd);
  score += Math.max(0, 20 - oddDiff * 5);
  
  // 4. å’Œå€¼åˆç†æ€§ (0-20åˆ†)
  const sum = numbers.reduce((a, b) => a + b, 0);
  const sumDiff = Math.abs(sum - stats.sumStats.avg);
  score += Math.max(0, 20 - sumDiff / 5);
  
  return Math.min(100, Math.round(score));
}

// ç²å–è©•ç´š
function getRating(score) {
  if (score >= 80) return {
    title: 'å„ªç§€çµ„åˆ',
    description: 'é€™æ˜¯ä¸€å€‹éå¸¸åˆç†çš„çµ„åˆï¼Œç¬¦åˆå¤šé …çµ±è¨ˆè¦å¾‹',
    status: 'success',
    color: 'var(--primary)'
  };
  if (score >= 60) return {
    title: 'è‰¯å¥½çµ„åˆ',
    description: 'çµ„åˆçµæ§‹åˆç†ï¼Œæœ‰æ”¹é€²ç©ºé–“',
    status: 'success',
    color: 'var(--primary)'
  };
  if (score >= 40) return {
    title: 'ä¸€èˆ¬çµ„åˆ',
    description: 'åŸºæœ¬åˆç†ï¼Œä½†éƒ¨åˆ†ç‰¹å¾µåé›¢å¸¸è¦',
    status: 'warning',
    color: 'var(--warning)'
  };
  return {
    title: 'éœ€è¦æ”¹é€²',
    description: 'çµ„åˆåé›¢æ­·å²è¦å¾‹è¼ƒå¤šï¼Œå»ºè­°èª¿æ•´',
    status: 'error',
    color: 'var(--danger)'
  };
}

// åˆ†æå–®å€‹è™Ÿç¢¼
function analyzeNumber(num, stats) {
  const freq = stats.frequency[num] || 0;
  const missed = data.length - (stats.lastSeen[num] || 0);
  const freqRatio = (freq / data.length * 100).toFixed(1);
  const avgFreq = (data.length * 5 / 39);
  
  let status = '';
  let statusColor = '';
  let score = 0;
  
  if (freq > avgFreq * 1.5) {
    status = 'ç†±é–€';
    statusColor = 'var(--danger)';
    score = 6;
  } else if (freq < avgFreq * 0.5) {
    status = 'å†·é–€';
    statusColor = 'var(--info)';
    score = 4;
  } else {
    status = 'æº«è™Ÿ';
    statusColor = 'var(--warning)';
    score = 8;
  }
  
  if (missed > 20) {
    status = 'é•·æœŸéºæ¼';
    statusColor = 'var(--warning)';
    score += 5;
  } else if (missed < 5) {
    status = 'è¿‘æœŸå‡ºç¾';
    score += 2;
  } else {
    score += 4;
  }
  
  return { num, freq, missed, freqRatio, status, statusColor, score };
}

// ç²å–è™Ÿç¢¼é¡åˆ¥
function getNumberClass(num, stats) {
  const freq = stats.frequency[num] || 0;
  const avgFreq = data.length * 5 / 39;
  
  if (freq > avgFreq * 1.5) return 'hot';
  if (freq < avgFreq * 0.5) return 'cold';
  return '';
}

// ç”Ÿæˆæ”¹é€²å»ºè­°
function generateImprovementSuggestions(numbers, stats) {
  const suggestions = [];
  
  // æª¢æŸ¥å¥‡å¶æ¯”
  const oddCount = numbers.filter(n => n % 2 === 1).length;
  const expectedOdd = Math.round(parseFloat(stats.oddEvenStats.avgOdd));
  
  if (Math.abs(oddCount - expectedOdd) > 1) {
    suggestions.push(`å¥‡å¶æ¯”ä¾‹å»ºè­°èª¿æ•´ç‚º ${expectedOdd}å¥‡${5-expectedOdd}å¶`);
  }
  
  // æª¢æŸ¥å’Œå€¼
  const sum = numbers.reduce((a, b) => a + b, 0);
  const sumRange = stats.sumStats.suggestedRange.split('-');
  
  if (sum < sumRange[0] || sum > sumRange[1]) {
    suggestions.push(`å’Œå€¼å»ºè­°ä¿æŒåœ¨ ${sumRange[0]}-${sumRange[1]} ç¯„åœå…§`);
  }
  
  // æª¢æŸ¥ç†±å†·åˆ†å¸ƒ
  const hotCount = numbers.filter(num => stats.hotNumbers.includes(num)).length;
  const coldCount = numbers.filter(num => stats.coldNumbers.includes(num)).length;
  
  if (hotCount > 3) {
    suggestions.push('ç†±é–€è™Ÿç¢¼éå¤šï¼Œå»ºè­°åŠ å…¥1-2å€‹å†·é–€æˆ–æº«è™Ÿ');
  }
  
  if (coldCount > 2) {
    suggestions.push('å†·é–€è™Ÿç¢¼éå¤šï¼Œå»ºè­°åŠ å…¥æ›´å¤šç†±é–€è™Ÿç¢¼');
  }
  
  return suggestions.length > 0 ? suggestions.join('<br>') : 'çµ„åˆçµæ§‹è‰¯å¥½ï¼Œç„¡æ˜é¡¯å•é¡Œ';
}

// ç”Ÿæˆæ™ºèƒ½é æ¸¬
function generateSmartPrediction() {
  if (!validateData()) return;
  
  showLoading('loadingC', true);
  
  setTimeout(() => {
    if (!analysisCache) {
      analysisCache = calculateAdvancedStats();
    }
    
    const prediction = generatePredictionNumbers('smart');
    displayPrediction(prediction, 'æ™ºèƒ½é æ¸¬');
    showLoading('loadingC', false);
  }, 800);
}

// ç”Ÿæˆè¶¨å‹¢é æ¸¬
function generateTrendPrediction() {
  if (!validateData()) return;
  
  showLoading('loadingC', true);
  
  setTimeout(() => {
    if (!analysisCache) {
      analysisCache = calculateAdvancedStats();
    }
    
    const prediction = generatePredictionNumbers('trend');
    displayPrediction(prediction, 'è¶¨å‹¢é æ¸¬');
    showLoading('loadingC', false);
  }, 800);
}

// ç”Ÿæˆå¹³è¡¡é æ¸¬
function generateBalancedPrediction() {
  if (!validateData()) return;
  
  showLoading('loadingC', true);
  
  setTimeout(() => {
    if (!analysisCache) {
      analysisCache = calculateAdvancedStats();
    }
    
    const prediction = generatePredictionNumbers('balanced');
    displayPrediction(prediction, 'å¹³è¡¡é æ¸¬');
    showLoading('loadingC', false);
  }, 800);
}

// ç”Ÿæˆé æ¸¬è™Ÿç¢¼
function generatePredictionNumbers(strategy) {
  const stats = analysisCache;
  let candidates = [];
  
  switch(strategy) {
    case 'smart':
      candidates = generateSmartCandidates(stats);
      break;
    case 'trend':
      candidates = generateTrendCandidates(stats);
      break;
    case 'balanced':
      candidates = generateBalancedCandidates(stats);
      break;
  }
  
  // é¸æ“‡æœ€çµ‚è™Ÿç¢¼
  const selected = selectFinalNumbers(candidates, stats, strategy);
  
  // ç¢ºä¿å”¯ä¸€æ€§
  return Array.from(new Set(selected)).sort((a, b) => a - b);
}

// ç”Ÿæˆæ™ºèƒ½å€™é¸
function generateSmartCandidates(stats) {
  const candidates = [];
  
  for (let num = 1; num <= 39; num++) {
    const freq = stats.frequency[num] || 0;
    const missed = data.length - (stats.lastSeen[num] || 0);
    const isTrend = stats.trendNumbers.some(t => t.num === num);
    
    let score = 0;
    
    // é »ç‡å› ç´  (0-30åˆ†)
    const avgFreq = data.length * 5 / 39;
    if (Math.abs(freq - avgFreq) <= 2) score += 30;
    else if (freq > avgFreq) score += 25;
    else score += 20;
    
    // éºæ¼å› ç´  (0-40åˆ†)
    if (missed >= 8 && missed <= 20) score += 40;
    else if (missed > 20) score += 35;
    else if (missed < 5) score += 20;
    else score += 30;
    
    // è¶¨å‹¢å› ç´  (0-30åˆ†)
    if (isTrend) score += 30;
    
    candidates.push({ num, score });
  }
  
  return candidates.sort((a, b) => b.score - a.score);
}

// ç”Ÿæˆè¶¨å‹¢å€™é¸
function generateTrendCandidates(stats) {
  return stats.trendNumbers.map(item => ({
    num: item.num,
    score: item.freq5 * 20 + (30 - item.missed)
  })).sort((a, b) => b.score - a.score);
}

// ç”Ÿæˆå¹³è¡¡å€™é¸
function generateBalancedCandidates(stats) {
  const candidates = [];
  
  for (let num = 1; num <= 39; num++) {
    let score = 50; // åŸºç¤åˆ†
    
    // ç¢ºä¿åˆ†å¸ƒå¹³è¡¡
    if (num <= 13) score += 10; // å°è™Ÿ
    else if (num >= 27) score += 10; // å¤§è™Ÿ
    
    if (num % 2 === 1) score += 5; // å¥‡æ•¸
    else score += 5; // å¶æ•¸
    
    // é¿å…æ¥µç«¯
    const freq = stats.frequency[num] || 0;
    if (freq === 0) score -= 10; // å¾æœªå‡ºç¾
    if (stats.hotNumbers.includes(num)) score += 5;
    if (stats.coldNumbers.includes(num)) score -= 5;
    
    candidates.push({ num, score });
  }
  
  return candidates.sort((a, b) => b.score - a.score);
}

// é¸æ“‡æœ€çµ‚è™Ÿç¢¼
function selectFinalNumbers(candidates, stats, strategy) {
  const selected = [];
  const used = new Set();
  
  // é¸æ“‡å‰10å€‹å€™é¸
  const topCandidates = candidates.slice(0, 10);
  
  // æ ¹æ“šç­–ç•¥é¸æ“‡
  while (selected.length < 5 && topCandidates.length > 0) {
    // è¼ªæµå¾ä¸åŒå€é–“é¸æ“‡
    const index = selected.length % Math.min(5, topCandidates.length);
    const candidate = topCandidates[index];
    
    if (!used.has(candidate.num)) {
      // æª¢æŸ¥çµ„åˆç‰¹æ€§
      if (validateCombinationAddition(selected, candidate.num, stats, strategy)) {
        selected.push(candidate.num);
        used.add(candidate.num);
      }
    }
    
    // ç§»é™¤å·²è™•ç†çš„å€™é¸
    topCandidates.splice(index, 1);
  }
  
  // å¦‚æœä¸å¤ ï¼Œè£œé½Š
  while (selected.length < 5) {
    for (let num = 1; num <= 39; num++) {
      if (!used.has(num) && validateCombinationAddition(selected, num, stats, strategy)) {
        selected.push(num);
        used.add(num);
        break;
      }
    }
  }
  
  return selected;
}

// é©—è­‰çµ„åˆæ·»åŠ 
function validateCombinationAddition(current, newNum, stats, strategy) {
  const temp = [...current, newNum];
  
  // åŸºæœ¬æª¢æŸ¥
  if (temp.length !== new Set(temp).size) return false;
  
  // ç­–ç•¥ç‰¹å®šæª¢æŸ¥
  switch(strategy) {
    case 'balanced':
      // æª¢æŸ¥å¥‡å¶å¹³è¡¡
      const oddCount = temp.filter(n => n % 2 === 1).length;
      if (oddCount > 4 || oddCount < 1) return false;
      
      // æª¢æŸ¥å¤§å°å¹³è¡¡
      const largeCount = temp.filter(n => n >= 20).length;
      if (largeCount > 4 || largeCount < 1) return false;
      break;
  }
  
  return true;
}

// é¡¯ç¤ºé æ¸¬çµæœ
function displayPrediction(numbers, strategy) {
  const container = document.getElementById('panelC');
  container.style.display = 'block';
  
  const stats = analysisCache;
  const score = evaluateCombination(numbers, stats);
  const rating = getRating(score);
  
  const oddCount = numbers.filter(n => n % 2 === 1).length;
  const largeCount = numbers.filter(n => n >= 20).length;
  const sum = numbers.reduce((a, b) => a + b, 0);
  const avg = sum / 5;
  
  document.getElementById('predictionResults').innerHTML = `
    <div class="box">
      <div class="box-title">ğŸ¯ ${strategy} çµæœ</div>
      
      <div class="numbers-grid">
        ${numbers.map(num => `
          <div class="number-ball selected">${num}</div>
        `).join('')}
      </div>
      
      <div class="status ${rating.status}">
        <strong>çµ„åˆè©•åˆ†: ${score}/100</strong><br>
        ${rating.description}
      </div>
      
      <div class="stats-row">
        <div class="stat-item">
          <div class="stat-label">ç­–ç•¥</div>
          <div class="stat-value">${strategy}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">å¥‡å¶</div>
          <div class="stat-value">${oddCount}å¥‡${5-oddCount}å¶</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">å¤§å°</div>
          <div class="stat-value">${largeCount}å¤§${5-largeCount}å°</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">ç¸½å’Œ</div>
          <div class="stat-value">${sum}</div>
        </div>
      </div>
    </div>
    
    <div class="box">
      <div class="box-title">ğŸ’¡ ä½¿ç”¨å»ºè­°</div>
      <div class="status info">
        <strong>è¤‡è£½çµ„åˆï¼š</strong> ${numbers.join(' ')}<br>
        <strong>å»ºè­°ç”¨æ³•ï¼š</strong> å¯èˆ‡å…¶ä»–ç­–ç•¥çµ„åˆæ­é…ä½¿ç”¨<br>
        <strong>æ›´æ–°é »ç‡ï¼š</strong> å»ºè­°æ¯æœŸæ›´æ–°æ•¸æ“šå¾Œé‡æ–°åˆ†æ
      </div>
    </div>
    
    <div class="btn-group">
      <button class="btn" onclick="copyToClipboard('${numbers.join(' ')}')">
        ğŸ“‹ è¤‡è£½çµ„åˆ
      </button>
      <button class="btn" onclick="addToVerification('${numbers.join(' ')}')">
        âœ… åŠ å…¥é©—è­‰
      </button>
      <button class="btn" onclick="savePrediction()">
        ğŸ’¾ å„²å­˜çµ„åˆ
      </button>
    </div>
  `;
}

// éš¨æ©Ÿç”Ÿæˆçµ„åˆ
function generateRandomCombination() {
  const numbers = generateUniqueNumbers(5, 1, 39);
  document.getElementById('verifyInput').value = numbers.join(' ');
  runVerify();
}

// æ¸…é™¤é©—è­‰
function clearVerification() {
  document.getElementById('verifyInput').value = '';
  document.getElementById('panelB').style.display = 'none';
}

// é¸æ“‡è™Ÿç¢¼
function selectNumber(num) {
  const ball = document.querySelector(`[data-number="${num}"]`);
  ball.classList.toggle('selected');
  
  // æ›´æ–°é©—è­‰è¼¸å…¥æ¡†
  const selected = Array.from(document.querySelectorAll('.number-ball.selected'))
    .map(el => parseInt(el.dataset.number))
    .filter(n => !isNaN(n));
  
  if (selected.length <= 5) {
    document.getElementById('verifyInput').value = selected.join(' ');
  }
}

// é™„åŠ è™Ÿç¢¼é»æ“Šäº‹ä»¶
function attachNumberClickEvents() {
  document.querySelectorAll('.number-ball').forEach(ball => {
    ball.addEventListener('click', function() {
      const num = parseInt(this.dataset.number);
      selectNumber(num);
    });
  });
}

// è¤‡è£½åˆ°å‰ªè²¼æ¿
function copyToClipboard(text) {
  navigator.clipboard.writeText(text).then(() => {
    alert('çµ„åˆå·²è¤‡è£½åˆ°å‰ªè²¼æ¿ï¼');
  });
}

// æ·»åŠ åˆ°é©—è­‰
function addToVerification(numbers) {
  document.getElementById('verifyInput').value = numbers;
  runVerify();
}

// å„²å­˜é æ¸¬
function savePrediction() {
  const predictions = JSON.parse(localStorage.getItem('predictions') || '[]');
  const newPrediction = {
    id: Date.now(),
    numbers: document.querySelectorAll('.number-ball.selected')
      .map(el => parseInt(el.dataset.number))
      .filter(n => !isNaN(n)),
    timestamp: new Date().toISOString(),
    score: evaluateCombination(
      Array.from(document.querySelectorAll('.number-ball.selected'))
        .map(el => parseInt(el.dataset.number))
        .filter(n => !isNaN(n)),
      analysisCache
    )
  };
  
  predictions.push(newPrediction);
  localStorage.setItem('predictions', JSON.stringify(predictions));
  
  alert('çµ„åˆå·²å„²å­˜ï¼');
}

// å·¥å…·å‡½æ•¸
function validateData() {
  if (data.length === 0) {
    alert('è«‹å…ˆä¸Šè¼‰æ•¸æ“šæ–‡ä»¶');
    return false;
  }
  return true;
}

function validateCombination(numbers) {
  if (numbers.length !== 5) {
    alert('è«‹è¼¸å…¥5å€‹è™Ÿç¢¼');
    return false;
  }
  
  if (new Set(numbers).size !== 5) {
    alert('è™Ÿç¢¼ä¸èƒ½é‡è¤‡');
    return false;
  }
  
  if (numbers.some(n => n < 1 || n > 39 || isNaN(n))) {
    alert('è™Ÿç¢¼å¿…é ˆåœ¨1-39ä¹‹é–“');
    return false;
  }
  
  return true;
}

function showStatus(elementId, message, type = 'info') {
  const element = document.getElementById(elementId);
  element.innerHTML = `<div class="status ${type}">${message}</div>`;
}

function showLoading(loadingId, show) {
  const element = document.getElementById(loadingId);
  element.style.display = show ? 'block' : 'none';
}

function animateProgress(duration) {
  const progress = document.getElementById('progressFill');
  progress.style.width = '0%';
  
  let start = null;
  function step(timestamp) {
    if (!start) start = timestamp;
    const progress = (timestamp - start) / duration * 100;
    document.getElementById('progressFill').style.width = `${Math.min(progress, 100)}%`;
    
    if (progress < 100) {
      requestAnimationFrame(step);
    }
  }
  
  requestAnimationFrame(step);
}

function getCommonRange(array) {
  const counts = {};
  array.forEach(num => {
    const range = Math.floor(num / 10) * 10;
    counts[range] = (counts[range] || 0) + 1;
  });
  
  const mostCommon = Object.entries(counts).sort((a, b) => b[1] - a[1])[0];
  return `${mostCommon[0]}-${parseInt(mostCommon[0]) + 9}`;
}

function getMostCommonPattern(array) {
  const counts = {};
  array.forEach(num => {
    counts[num] = (counts[num] || 0) + 1;
  });
  
  const mostCommon = Object.entries(counts).sort((a, b) => b[1] - a[1])[0];
  return mostCommon[0];
}

function countExtremePatterns(array) {
  return array.filter(num => num === 0 || num === 5).length;
}

// é»æ“Šæ”¶åˆé‚è¼¯èªªæ˜
document.getElementById('toggleLogic').addEventListener('click', function() {
  const content = document.getElementById('logicContent');
  const icon = this.querySelector('span:last-child');
  
  if (content.style.display === 'none') {
    content.style.display = 'block';
    icon.textContent = 'â–²';
  } else {
    content.style.display = 'none';
    icon.textContent = 'â–¼';
  }
});
</script>
</body>
</html>
