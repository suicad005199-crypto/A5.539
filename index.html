<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CSV 目標號碼規則分析</title>
<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", Helvetica, Arial, sans-serif;
  background-color: #f9f9f9;
  padding: 20px;
}
h1, h2 {
  text-align: center;
}
input[type="file"], input[type="number"] {
  display: block;
  margin: 10px auto;
  font-size: 18px;
  width: 80%;
}
button {
  display: block;
  margin: 15px auto;
  padding: 12px 25px;
  font-size: 18px;
  border: none;
  background-color: #007AFF;
  color: white;
  border-radius: 10px;
}
#result {
  margin-top: 20px;
  font-size: 18px;
  line-height: 1.6;
}
.number-box {
  display: inline-block;
  margin: 5px;
  padding: 10px 15px;
  border-radius: 50%;
  background-color: #FFD700;
  color: #000;
  font-weight: bold;
  font-size: 20px;
  width: 45px;
  text-align: center;
}
</style>
</head>
<body>

<h1>CSV 目標號碼規則分析</h1>
<p style="text-align:center;">手動輸入五個號碼，並上傳 CSV 歷史號碼，比對規律</p>

<div style="text-align:center;">
  <input type="number" id="num1" placeholder="號碼 1" min="1" max="39">
  <input type="number" id="num2" placeholder="號碼 2" min="1" max="39">
  <input type="number" id="num3" placeholder="號碼 3" min="1" max="39">
  <input type="number" id="num4" placeholder="號碼 4" min="1" max="39">
  <input type="number" id="num5" placeholder="號碼 5" min="1" max="39">
</div>

<input type="file" id="csvFile" accept=".csv">
<button id="analyzeBtn">分析號碼規律</button>

<div id="result"></div>

<script>
// 解析 CSV
function parseCSV(text) {
  const rows = text.trim().split(/\r?\n/);
  const data = [];
  rows.slice(1).forEach(row => {
    const cols = row.split(',');
    const nums = cols.slice(1).map(n => parseInt(n.trim())).filter(n => !isNaN(n));
    data.push(nums);
  });
  return data;
}

// 計算區間分布
function getRangeDistribution(numbers) {
  const ranges = {
    "1-10": [],
    "11-20": [],
    "21-30": [],
    "31-39": []
  };
  numbers.forEach(n=>{
    if(n>=1 && n<=10) ranges["1-10"].push(n);
    else if(n>=11 && n<=20) ranges["11-20"].push(n);
    else if(n>=21 && n<=30) ranges["21-30"].push(n);
    else if(n>=31 && n<=39) ranges["31-39"].push(n);
  });
  return ranges;
}

// 分析規則
function analyzeRules(inputNumbers, data){
  const recent = {};
  const days = Math.min(15,data.length);
  for(let i=data.length-days;i<data.length;i++){
    data[i].forEach(n=> recent[n]=(recent[n]||0)+1);
  }

  const ranges = getRangeDistribution(inputNumbers);
  let html = "<h2>分析結果</h2>";

  // 顯示輸入號碼
  html += `<div>`;
  inputNumbers.forEach(n=> html += `<span class="number-box">${n}</span>`);
  html += `</div>`;

  // 分析每個號碼的規律
  html += `<p>號碼分區與最近出現次數：</p><ul>`;
  inputNumbers.forEach(n=>{
    const range = n<=10?"1-10":n<=20?"11-20":n<=30?"21-30":"31-39";
    const count = recent[n]||0;
    html += `<li>號碼 ${n} → 區間 ${range}，最近 ${days} 天出現 ${count} 次</li>`;
  });
  html += "</ul>";

  // 規則判斷
  let matchRule = true;
  for(let n of inputNumbers){
    if(!recent[n]) matchRule = false;
  }

  if(matchRule){
    html += `<p><strong>✅ 所有號碼近期都有出現，符合「區間分布 + 最近出現」規則</strong></p>`;
  } else {
    html += `<p><strong>❌ 部分號碼近期未出現，可能不符合生成規則</strong></p>`;
  }

  return html;
}

document.getElementById('analyzeBtn').addEventListener('click',()=>{
  const nums = [
    parseInt(document.getElementById('num1').value),
    parseInt(document.getElementById('num2').value),
    parseInt(document.getElementById('num3').value),
    parseInt(document.getElementById('num4').value),
    parseInt(document.getElementById('num5').value)
  ];
  if(nums.some(n=>isNaN(n) || n<1 || n>39)){
    alert("請輸入 1-39 的五個號碼");
    return;
  }

  const fileInput = document.getElementById('csvFile');
  const file = fileInput.files[0];
  const resultDiv = document.getElementById('result');

  if(!file){
    alert("請先上傳 CSV 檔案");
    return;
  }

  const reader = new FileReader();
  reader.onload = function(e){
    const text = e.target.result;
    const data = parseCSV(text);
    const html = analyzeRules(nums,data);
    resultDiv.innerHTML = html;
  };
  reader.readAsText(file);
});
</script>

</body>
</html>
