<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>539 â‰¥2 æ˜Ÿç­–ç•¥å›æ¸¬èˆ‡é æ¸¬</title>

<style>
body { font-family: system-ui; background:#f8fafc; padding:20px; color:#1e293b }
.container { max-width:1000px; margin:auto }

h2,h3 { margin:10px 0 }
.card { background:#fff; border-radius:10px; padding:15px; margin-bottom:15px; box-shadow:0 1px 3px rgba(0,0,0,.1) }

button { padding:6px 16px; background:#2563eb; color:#fff; border:0; border-radius:6px; cursor:pointer }

table { width:100%; border-collapse:collapse; font-size:14px }
th,td { padding:8px; border-bottom:1px solid #e5e7eb; vertical-align:top }

.num { display:inline-block; padding:2px 6px; margin:2px; border:1px solid #cbd5e1; border-radius:4px; font-family:monospace }
.hit { background:#22c55e; color:#fff; border-color:#16a34a }
.draw { background:#64748b; color:#fff; border-color:#475569 }

.panel { max-height:380px; overflow:auto }
</style>
</head>

<body>
<div class="container">

<h2>ğŸ“Š 539 å°ˆæ”» â‰¥2 æ˜Ÿ å›æ¸¬ / ä¸‹æœŸé æ¸¬</h2>

<input type="file" id="csv" accept=".csv">
<button onclick="run()">åŸ·è¡Œ</button>

<!-- ä¸‹æœŸé æ¸¬ -->
<div id="next" class="card"></div>

<!-- å›æ¸¬ log -->
<div class="card">
<h3>å›æ¸¬ Logï¼ˆé–‹ç vs é æ¸¬ï¼‰</h3>
<div id="log" class="panel"></div>
</div>

<!-- é‚è¼¯èªªæ˜ -->
<div class="card" id="logic"></div>

</div>

<script>
/* ---------- åŸºç¤ ---------- */
function parseCSV(t){
  return t.trim().split('\n').slice(1).map(r=>{
    const p=r.split(',');
    return {date:p[0], nums:p.slice(1).map(Number)};
  }).filter(r=>r.nums.length===5);
}

function run(){
  const f=document.getElementById('csv').files[0];
  if(!f) return alert('è«‹ä¸Šå‚³ CSV');
  const r=new FileReader();
  r.onload=e=>simulate(parseCSV(e.target.result));
  r.readAsText(f);
}

/* ---------- æ ¸å¿ƒç­–ç•¥ï¼ˆå°ˆæ”» â‰¥2ï¼‰ ---------- */
function buildPool(data,i){
  const hist=data.slice(i-10,i);
  const freq={};
  hist.forEach(d=>d.nums.forEach(n=>freq[n]=(freq[n]||0)+1));
  return Object.keys(freq)
    .filter(n=>freq[n]>=2)
    .map(Number)
    .slice(0,20);
}

function genPicks(pool,count=5){
  const picks=[];
  let idx=0;
  while(picks.length<count){
    let c=[];
    for(let k=0;k<pool.length && c.length<5;k++){
      const n=pool[(idx+k*2)%pool.length];
      if(!c.includes(n)) c.push(n);
    }
    idx++;
    c.sort((a,b)=>a-b);
    if(!picks.some(p=>p.join()==c.join())) picks.push(c);
  }
  return picks;
}

/* ---------- å›æ¸¬ ---------- */
function simulate(data){
  let rows='';
  let hit2=0, total=0;

  for(let i=10;i<data.length;i++){
    const draw=data[i].nums;
    const pool=buildPool(data,i);
    if(pool.length<5) continue;

    const picks=genPicks(pool);
    let best=0;

    const pickHTML=picks.map(p=>{
      const h=p.filter(n=>draw.includes(n)).length;
      best=Math.max(best,h);
      return `<div>${p.map(n=>
        `<span class="num ${draw.includes(n)?'hit':''}">${n}</span>`
      ).join('')}</div>`;
    }).join('');

    if(best>=2) hit2++;
    total++;

    rows=`
    <tr>
      <td>${data[i].date}</td>
      <td>${draw.map(n=>`<span class="num draw">${n}</span>`).join('')}</td>
      <td>${best} æ˜Ÿ</td>
      <td>${pickHTML}</td>
    </tr>`+rows;
  }

  document.getElementById('log').innerHTML=
    `<table>
      <tr><th>æ—¥æœŸ</th><th>é–‹ç</th><th>çµæœ</th><th>é æ¸¬ç‰Œçµ„</th></tr>
      ${rows}
    </table>`;

  renderNext(data);
  renderLogic(hit2,total);
}

/* ---------- ä¸‹æœŸé æ¸¬ ---------- */
function renderNext(data){
  const pool=buildPool(data,data.length);
  const picks=genPicks(pool);

  document.getElementById('next').innerHTML=`
    <h3>ğŸ“Œ ä¸‹æœŸé æ¸¬ç‰Œçµ„ï¼ˆ${data[data.length-1].date} å¾Œä¸€æœŸï¼‰</h3>
    ${picks.map((p,i)=>
      `<div><strong>çµ„${i+1}</strong>ï¼š
      ${p.map(n=>`<span class="num">${n}</span>`).join('')}</div>`
    ).join('')}
  `;
}

/* ---------- é‚è¼¯èªªæ˜ ---------- */
function renderLogic(hit2,total){
  document.getElementById('logic').innerHTML=`
    <h3>ç­–ç•¥é‚è¼¯ï¼ˆå°ˆæ”» â‰¥2 æ˜Ÿï¼‰</h3>
    <ul>
      <li>åƒ…ä½¿ç”¨ã€Œè¿‘ 10 æœŸå‡ºç¾ â‰¥2 æ¬¡ã€çš„é«˜è¦†è“‹è™Ÿç¢¼</li>
      <li>æ¯æœŸå›ºå®šç”¢ç”Ÿ 5 çµ„ï¼Œé¿å…äº‚æ•¸æ¼‚ç§»</li>
      <li>ç›®æ¨™ä¸æ˜¯çˆ†æ“Šï¼Œè€Œæ˜¯æé«˜ã€Œè‡³å°‘ä¸­ 2 æ˜Ÿã€æ©Ÿç‡</li>
      <li>å›æ¸¬ â‰¥2 å‘½ä¸­ç‡ï¼šç´„ ${(hit2/total*100).toFixed(1)}%</li>
      <li>ç­–ç•¥å®šä½ï¼šè¦†è“‹å°å‘ã€ä½æ³¢å‹•</li>
    </ul>
  `;
}
</script>
</body>
</html>
