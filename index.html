<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>539 QUANT PRO - å°ˆæ¥­é‡åŒ–åˆ†æ</title>
<style>
:root {
    --primary: #0f172a;
    --secondary: #1e293b;
    --accent: #0ea5e9;
    --gold: #f59e0b;
    --success: #10b981;
    --text: #f8fafc;
    --glass: rgba(30, 41, 59, 0.7);
    --border: rgba(255, 255, 255, 0.1);
}

body {
    font-family: 'Inter', 'PingFang TC', system-ui, sans-serif;
    background-color: var(--primary);
    background-image: 
        radial-gradient(at 0% 0%, rgba(14, 165, 233, 0.15) 0px, transparent 50%),
        radial-gradient(at 100% 100%, rgba(245, 158, 11, 0.1) 0px, transparent 50%);
    color: var(--text);
    margin: 0; padding: 20px;
    line-height: 1.5;
}

.container { max-width: 800px; margin: 0 auto; }

header { text-align: center; margin-bottom: 40px; padding-top: 20px; }
header h1 { 
    font-size: 2.5rem; margin: 0; font-weight: 900; letter-spacing: -1px;
    background: linear-gradient(135deg, #fff 30%, var(--accent));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}
header p { opacity: 0.5; font-size: 0.9rem; margin-top: 10px; text-transform: uppercase; letter-spacing: 2px; }

/* ç»ç’ƒæ“¬æ…‹å¡ç‰‡ */
.card { 
    background: var(--glass);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border: 1px solid var(--border);
    padding: 24px; margin-bottom: 24px; border-radius: 24px;
    box-shadow: 0 10px 30px -10px rgba(0,0,0,0.5);
}

/* ä¸Šå‚³å€å¡Šå„ªåŒ– */
.upload-section { 
    border: 2px dashed rgba(56, 189, 248, 0.3); 
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}
.upload-section:hover { 
    border-color: var(--accent); 
    background: rgba(56, 189, 248, 0.08);
    transform: translateY(-2px);
}
#fileLabel { display: block; margin-bottom: 15px; font-weight: 500; color: var(--accent); }

button { 
    width: 100%; padding: 18px; border: none; border-radius: 16px; 
    font-weight: 700; font-size: 1.1rem; 
    background: linear-gradient(135deg, var(--accent), #0369a1); 
    color: white; cursor: pointer; transition: 0.3s;
    box-shadow: 0 4px 15px rgba(14, 165, 233, 0.4);
}
button:active { transform: scale(0.98); }

/* è™Ÿç¢¼çƒçƒç¾åŒ– */
.ball { 
    display: inline-flex; align-items: center; justify-content: center;
    width: 42px; height: 42px; border-radius: 12px;
    background: linear-gradient(145deg, #334155, #1e293b);
    margin: 4px; font-weight: 800; font-size: 1.1rem; 
    color: var(--accent); border: 1px solid rgba(255,255,255,0.05);
    box-shadow: inset 0 2px 4px rgba(255,255,255,0.05);
}

.strategy-block h3 { 
    color: var(--gold); font-size: 1.4rem; margin: 0 0 20px 0;
    display: flex; align-items: center;
}
.strategy-block h3::before {
    content: ''; display: inline-block; width: 4px; height: 24px; 
    background: var(--gold); margin-right: 12px; border-radius: 2px;
}

/* çµæœæ’ç‰ˆå„ªåŒ– */
.result-card {
    display: flex; flex-direction: column;
    background: rgba(15, 23, 42, 0.5); padding: 16px; border-radius: 18px;
    margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.03);
}

.result-numbers { margin-bottom: 12px; display: flex; flex-wrap: wrap; }

.result-rate { 
    display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px;
    padding-top: 12px; border-top: 1px solid rgba(255,255,255,0.05);
}
.rate-item {
    font-size: 0.75rem; text-align: center; color: #94a3b8;
}
.rate-item b { display: block; color: var(--gold); font-size: 0.9rem; }

/* æ­·å²è¡¨æ ¼ */
table { width: 100%; border-collapse: separate; border-spacing: 0 8px; }
tr { background: rgba(255,255,255,0.02); }
td { padding: 12px; text-align: center; }
td:first-child { border-radius: 12px 0 0 12px; color: #64748b; font-size: 0.8rem; }
td:last-child { border-radius: 0 12px 12px 0; }

@media (max-width: 480px) {
    .result-rate { grid-template-columns: repeat(2, 1fr); }
    .ball { width: 36px; height: 36px; font-size: 1rem; }
}
</style>
</head>
<body>

<div class="container">
    <header>
        <h1>539 QUANT PRO</h1>
        <p>Advanced Quantitative Analysis</p>
    </header>

    <div class="card upload-section">
        <label for="csvFile" id="fileLabel">ğŸ“Š è«‹æ”¾å…¥æ­·å²é–‹çæ•¸æ“š CSV</label>
        <input type="file" id="csvFile" accept=".csv" style="display:none;">
        <button onclick="runAll()">é–‹å§‹æ™ºèƒ½åˆ†æ</button>
    </div>

    <div id="history" class="card">
        <div style="text-align:center; opacity:0.5; padding:20px;">ç­‰å¾…æ•¸æ“šå°å…¥...</div>
    </div>
    
    <div id="strategies"></div>
</div>

<script>
// æ­¤è™•ä¿ç•™æ‚¨åŸæœ¬çš„ JavaScript é‚è¼¯ï¼Œåƒ…ä¿®æ”¹ generateAllStrategies è¼¸å‡ºçš„ HTML çµæ§‹ä»¥é©æ‡‰æ–° UI
let HIST_DATA = [];

document.getElementById('csvFile').addEventListener('change', function(e){
    const name = e.target.files[0] ? e.target.files[0].name : "ğŸ“Š è«‹æ”¾å…¥æ­·å²é–‹çæ•¸æ“š CSV";
    document.getElementById('fileLabel').innerText = name;
});

async function runAll(){
    const fileInput = document.getElementById("csvFile");
    if(!fileInput.files[0]){ alert("è«‹å…ˆé¸å– CSV"); return; }
    const text = await fileInput.files[0].text();
    HIST_DATA = parseCSV(text);
    if(HIST_DATA.length===0){ alert("CSVè§£æå¤±æ•—"); return; }
    showHistory(HIST_DATA);
    generateAllStrategies(HIST_DATA);
}

function parseCSV(text){
    const lines = text.trim().split(/\r?\n/);
    lines.shift();
    return lines.map(l=>{
        const p = l.split(",");
        if(p.length<6) return null;
        const nums = p.slice(1,6).map(n=>parseInt(n.trim())).sort((a,b)=>a-b);
        return {date:p[0].trim(), nums:nums};
    }).filter(x=>x!==null && !x.nums.some(isNaN)).sort((a,b)=> new Date(a.date)-new Date(b.date));
}

function showHistory(data){
    let html="<h3 style='margin-top:0; color:var(--accent);'>è¿‘æœŸæ­·å²</h3><table>";
    data.slice(-5).reverse().forEach(d=>{
        html += `<tr><td>${d.date}</td><td>${d.nums.map(n=>`<span class='ball'>${String(n).padStart(2,'0')}</span>`).join("")}</td></tr>`;
    });
    html += "</table>";
    document.getElementById("history").innerHTML = html;
}

function generateAllStrategies(data){
    const container = document.getElementById("strategies");
    container.innerHTML = "";
    const strategies = [
        {name:"ç†±è™Ÿè¶¨å‹¢ç­–ç•¥", func:generateHotStrategy},
        {name:"å†·ç†±å‡å€¼å‡è¡¡", func:generateMixedStrategy},
        {name:"éš¨æ©Ÿæ‰è½æ¨¡æ“¬", func:generateDropStrategy}
    ];

    strategies.forEach(s=>{
        const block = document.createElement("div");
        block.className="card strategy-block";
        block.innerHTML=`<h3>${s.name}</h3>`;
        
        for(let i=0;i<3;i++){
            const nums = s.func(data);
            const rates = predictNextRate(nums,data);
            const line = document.createElement("div");
            line.className="result-card";
            line.innerHTML = `
                <div class="result-numbers">
                    ${nums.map(n=>`<span class="ball">${String(n).padStart(2,'0')}</span>`).join("")}
                </div>
                <div class="result-rate">
                    <div class="rate-item">2â˜…<b>${rates[2]}%</b></div>
                    <div class="rate-item">3â˜…<b>${rates[3]}%</b></div>
                    <div class="rate-item">4â˜…<b>${rates[4]}%</b></div>
                    <div class="rate-item">5â˜…<b>${rates[5]}%</b></div>
                </div>`;
            block.appendChild(line);
        }
        container.appendChild(block);
    });
}

function predictNextRate(nums,data){
    const last50 = data.slice(-50);
    const freq = {};
    last50.forEach(d=>d.nums.forEach(n=>freq[n]=(freq[n]||0)+1));
    const prob = {};
    for(let i=1;i<=39;i++){ prob[i]=(freq[i]||0)/50; }

    const N=5000;
    const hits={2:0,3:0,4:0,5:0};
    for(let i=0;i<N;i++){
        const draw=[];
        while(draw.length<5){
            const r=Math.random();
            let cumulative=0;
            for(let n=1;n<=39;n++){
                cumulative+=prob[n];
                if(r<=cumulative && !draw.includes(n)){ draw.push(n); break; }
            }
            if(draw.length<5) {
                let rn = Math.floor(Math.random()*39)+1;
                if(!draw.includes(rn)) draw.push(rn);
            }
        }
        const match=nums.filter(x=>draw.includes(x)).length;
        if(match>=2 && match<=5) hits[match]++;
    }
    for(let k in hits) hits[k]=((hits[k]/N)*100).toFixed(1);
    return hits;
}

function generateHotStrategy(data){
    const freq={};
    data.slice(-50).forEach(d=>d.nums.forEach(n=>freq[n]=(freq[n]||0)+1));
    const sorted=Object.entries(freq).sort((a,b)=>b[1]-a[1]).map(x=>parseInt(x[0])).slice(0,5);
    return shuffle(sorted);
}

function generateMixedStrategy(data){
    const freq={};
    data.slice(-50).forEach(d=>d.nums.forEach(n=>freq[n]=(freq[n]||0)+1));
    const sorted=Object.entries(freq).sort((a,b)=>b[1]-a[1]).map(x=>parseInt(x[0]));
    return shuffle(sorted.slice(0,3).concat(sorted.slice(-2)));
}

function generateDropStrategy(data){
    const lastNums = data.length > 0 ? data[data.length-1].nums : Array.from({length:39},(_,i)=>i+1);
    return shuffle([...lastNums]).slice(0,5);
}

function shuffle(array){ 
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}
</script>
</body>
</html>
