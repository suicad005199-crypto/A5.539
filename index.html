<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>539 è¦†è“‹å°å‘å›æ¸¬ç³»çµ±ï¼ˆçµ„åˆ¥è²¢ç»ï¼‰</title>
<style>
body { font-family: Arial; padding: 20px; }
table { border-collapse: collapse; margin-top: 12px; font-size: 13px; }
td, th { border: 1px solid #ccc; padding: 4px 6px; text-align: center; }
.hit2 { background:#e0f5e0; }
.hit3 { background:#a5e0a5; font-weight:bold; }
.hit4 { background:#ffd54f; font-weight:bold; }
</style>
</head>
<body>

<h2>539 è¦†è“‹å°å‘ç­–ç•¥ç³»çµ±ï¼ˆçµ„åˆ¥ â‰¥2 è²¢ç»ï¼‰</h2>

<input type="file" id="csvFile" accept=".csv">
<button onclick="run()">åŸ·è¡Œå›æ¸¬</button>

<div id="summary"></div>
<div id="group"></div>
<div id="next"></div>
<div id="log"></div>

<script>
function parseCSV(text) {
  return text.trim().split('\n').slice(1).map(l => {
    const p = l.split(',');
    return { date: p[0], nums: p.slice(1).map(Number) };
  });
}

function run() {
  const f = document.getElementById('csvFile').files[0];
  if (!f) return alert('è«‹ä¸Šå‚³ CSV');
  const r = new FileReader();
  r.onload = e => simulate(parseCSV(e.target.result));
  r.readAsText(f);
}

function buildCoveragePicks(fullData, idx) {
  const freq = {};
  fullData.slice(0, idx).forEach(d =>
    d.nums.forEach(n => freq[n] = (freq[n] || 0) + 1)
  );

  const cold = Object.keys(freq)
    .map(Number)
    .sort((a,b)=>freq[a]-freq[b]);

  return [
    [1,2,3,4,5],
    [10,11,12,13,14],
    [16,17,18,19,20],
    [25,26,27,28,29],
    cold.slice(0,5)
  ];
}

function simulate(data) {
  let hit2=0, hit3=0, hit4=0;
  let groupHit2=[0,0,0,0,0];
  let rows='';

  for (let i=0;i<data.length;i++) {
    const picks=buildCoveragePicks(data,i);
    const target=data[i].nums;

    let best=0;
    picks.forEach((p,gi)=>{
      const h=p.filter(n=>target.includes(n)).length;
      best=Math.max(best,h);
      if (h>=2) groupHit2[gi]++;
    });

    if (best>=2) hit2++;
    if (best>=3) hit3++;
    if (best>=4) hit4++;

    rows+=`<tr class="${best>=4?'hit4':best>=3?'hit3':best>=2?'hit2':''}">
      <td>${data[i].date}</td>
      <td>${best}</td>
      <td>${picks.map((p,i)=>`çµ„${i+1}ï¼š[${p.join(' ')}]`).join('<br>')}</td>
    </tr>`;
  }

  const total=data.length;

  document.getElementById('summary').innerHTML=`
    <h3>æ•´é«”å‘½ä¸­</h3>
    â‰¥2ï¼š${(hit2/total*100).toFixed(1)}%ã€€
    â‰¥3ï¼š${(hit3/total*100).toFixed(1)}%ã€€
    â‰¥4ï¼š${(hit4/total*100).toFixed(1)}%
  `;

  document.getElementById('group').innerHTML=`
    <h3>å„çµ„ â‰¥2 å‘½ä¸­æ¬¡æ•¸ï¼ˆè²¢ç»åº¦ï¼‰</h3>
    ${groupHit2.map((c,i)=>
      `çµ„${i+1}ï¼š${c} æœŸï¼ˆ${(c/total*100).toFixed(1)}%ï¼‰`
    ).join('<br>')}
  `;

  document.getElementById('log').innerHTML=
    `<table>
      <tr><th>æ—¥æœŸ</th><th>æœ€é«˜å‘½ä¸­</th><th>å‡ºæ‰‹ 5 çµ„</th></tr>
      ${rows}
    </table>`;

  predictNext(data);
}

function predictNext(data){
  const picks=buildCoveragePicks(data,data.length);
  document.getElementById('next').innerHTML=`
    <h3>ğŸ“Œ ä¸‹æœŸé æ¸¬ç‰Œçµ„ï¼ˆè¦†è“‹å°å‘ï¼‰</h3>
    ${picks.map((p,i)=>`çµ„${i+1}ï¼š[${p.join(' ')}]`).join('<br>')}
  `;
}
</script>
</body>
</html>
