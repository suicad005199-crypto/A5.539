<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>539 è¦†è“‹å°å‘å›æ¸¬ç³»çµ±ï¼ˆè·¯ Aï¼‰</title>
<style>
body { font-family: Arial; padding: 20px; }
table { border-collapse: collapse; margin-top: 12px; font-size: 13px; }
td, th { border: 1px solid #ccc; padding: 4px 6px; text-align: center; }
.hit2 { background:#e0f5e0; }
.hit3 { background:#a5e0a5; font-weight:bold; }
.hit4 { background:#ffd54f; font-weight:bold; }
</style>
</head>
<body>

<h2>539 è¦†è“‹å°å‘ç­–ç•¥ç³»çµ±ï¼ˆè·¯ Aï¼‰</h2>

<input type="file" id="csvFile" accept=".csv">
<button onclick="run()">åŸ·è¡Œå›æ¸¬</button>

<div id="summary"></div>
<div id="next"></div>
<div id="log"></div>

<script>
function parseCSV(text) {
  return text.trim().split('\n').slice(1).map(l => {
    const p = l.split(',');
    return { date: p[0], nums: p.slice(1).map(Number) };
  });
}

function run() {
  const f = document.getElementById('csvFile').files[0];
  if (!f) return alert('è«‹ä¸Šå‚³ CSV');
  const r = new FileReader();
  r.onload = e => simulate(parseCSV(e.target.result));
  r.readAsText(f);
}

function buildCoveragePicks(fullData, idx) {
  // è¨ˆç®—æ­·å²å‡ºç¾æ¬¡æ•¸ï¼ˆå…¨æ­·å²ï¼ŒéçŸ­çª—ï¼‰
  const freq = {};
  fullData.slice(0, idx).forEach(d =>
    d.nums.forEach(n => freq[n] = (freq[n] || 0) + 1)
  );

  // è£œæ´æ± ï¼šæ­·å²æœ€å°‘å‡ºç¾çš„è™Ÿç¢¼
  const cold = Object.keys(freq)
    .map(Number)
    .sort((a,b)=>freq[a]-freq[b]);

  return [
    rangePick(1,15),
    rangePick(10,24),
    rangePick(16,30),
    rangePick(25,39),
    cold.slice(0,5)
  ];
}

function rangePick(min, max) {
  let r=[];
  for(let i=min;i<=max;i++) r.push(i);
  return r.slice(0,5);
}

function simulate(data) {
  let hit2=0, hit3=0, hit4=0;
  let rows='';

  for (let i=0;i<data.length;i++) {
    const picks=buildCoveragePicks(data,i);
    const target=data[i].nums;

    let best=0;
    picks.forEach(p=>{
      const h=p.filter(n=>target.includes(n)).length;
      best=Math.max(best,h);
    });

    if (best>=2) hit2++;
    if (best>=3) hit3++;
    if (best>=4) hit4++;

    rows+=`<tr class="${best>=4?'hit4':best>=3?'hit3':best>=2?'hit2':''}">
      <td>${data[i].date}</td>
      <td>${best}</td>
      <td>${picks.map((p,i)=>`çµ„${i+1}ï¼š[${p.join(' ')}]`).join('<br>')}</td>
    </tr>`;
  }

  const total=data.length;
  document.getElementById('summary').innerHTML=`
    <h3>å›æ¸¬çµæœï¼ˆè¦†è“‹å°å‘ï¼‰</h3>
    å¯å›æ¸¬æœŸæ•¸ï¼š${total}<br>
    å‡ºæ‰‹æœŸæ•¸ï¼š${total}<br>
    â‰¥2 å‘½ä¸­ç‡ï¼š${(hit2/total*100).toFixed(1)}%<br>
    â‰¥3 å‘½ä¸­ç‡ï¼š${(hit3/total*100).toFixed(1)}%<br>
    â‰¥4 å‘½ä¸­ç‡ï¼š${(hit4/total*100).toFixed(1)}%
  `;

  document.getElementById('log').innerHTML=
    `<table>
      <tr><th>æ—¥æœŸ</th><th>æœ€é«˜å‘½ä¸­</th><th>å‡ºæ‰‹ 5 çµ„</th></tr>
      ${rows}
    </table>`;

  predictNext(data);
}

function predictNext(data){
  const picks=buildCoveragePicks(data,data.length);
  document.getElementById('next').innerHTML=`
    <h3>ğŸ“Œ ä¸‹æœŸé æ¸¬ç‰Œçµ„ï¼ˆ5 çµ„ï½œè¦†è“‹å°å‘ï¼‰</h3>
    ${picks.map((p,i)=>`çµ„${i+1}ï¼š[${p.join(' ')}]`).join('<br>')}
  `;
}
</script>
</body>
</html>
