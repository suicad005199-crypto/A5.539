<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>今彩539｜每週熱冷統計選號</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; }
textarea { width: 100%; height: 180px; }
button { padding: 10px 18px; margin-top: 10px; }
h3 { margin-top: 30px; }
.set { font-weight: bold; margin: 6px 0; }
.stat { font-size: 14px; }
</style>
</head>
<body>

<h2>今彩 539｜每週熱冷統計選號（娛樂用）</h2>

<p>貼上 CSV 內容（最新在上）：</p>
<textarea id="csvInput" placeholder="date,n1,n2,n3,n4,n5"></textarea>

<br>
<button onclick="run()">分析並產生本週 5 注</button>

<h3>熱 / 冷 統計（近 50 期）</h3>
<div id="stats"></div>

<h3>本週建議號碼</h3>
<div id="result"></div>

<script>
const SET_COUNT = 5;
const PICK_PER_SET = 5;
const HOT_COUNT = 2;
const COLD_COUNT = 1;
const MID_COUNT = 2;

function run() {
  const text = document.getElementById("csvInput").value.trim();
  if (!text) return;

  const rows = text.split("\n").slice(1, 51);
  const draws = rows.map(r => r.split(",").slice(1).map(Number));

  const freq = {};
  for (let i = 1; i <= 39; i++) freq[i] = 0;
  draws.forEach(d => d.forEach(n => freq[n]++));

  const sorted = Object.entries(freq).sort((a,b)=>b[1]-a[1]);
  const hot = sorted.slice(0,10).map(x=>Number(x[0]));
  const cold = sorted.slice(-10).map(x=>Number(x[0]));

  document.getElementById("stats").innerHTML =
    `<div class="stat">熱號 Top10：${hot.join("、")}</div>
     <div class="stat">冷號 Top10：${cold.join("、")}</div>`;

  const mids = Object.keys(freq)
    .map(Number)
    .filter(n => !hot.includes(n) && !cold.includes(n));

  const results = [];

  while (results.length < SET_COUNT) {
    const set = [];
    set.push(...pick(hot, HOT_COUNT));
    set.push(...pick(mids, MID_COUNT));
    set.push(...pick(cold, COLD_COUNT));

    const uniq = [...new Set(set)].sort((a,b)=>a-b);
    if (uniq.length !== 5) continue;
    if (!valid(uniq)) continue;
    if (results.some(r => overlap(r, uniq) > 2)) continue;

    results.push(uniq);
  }

  document.getElementById("result").innerHTML =
    results.map((s,i)=>`<div class="set">注 ${i+1}：${s.join("・")}</div>`).join("");
}

function pick(arr, n) {
  return [...arr].sort(()=>Math.random()-0.5).slice(0,n);
}

function valid(set) {
  const odd = set.filter(n=>n%2).length;
  const small = set.filter(n=>n<=19).length;
  if (![2,3].includes(odd)) return false;
  if (![2,3].includes(small)) return false;
  if (set.every(n=>n<=31)) return false;

  let seq = 0;
  for (let i=1;i<set.length;i++) {
    if (set[i] === set[i-1]+1) seq++;
  }
  return seq <= 1;
}

function overlap(a,b) {
  return a.filter(n=>b.includes(n)).length;
}
</script>

</body>
</html>
