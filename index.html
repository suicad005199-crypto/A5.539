<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>539 æ™ºèƒ½åˆ†æ PRO</title>
<style>
    :root { --primary: #0f172a; --accent: #0ea5e9; --gold: #f59e0b; --bg: #020617; --text: #f8fafc; }
    body { font-family: sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 15px; }
    .card { background: rgba(30, 41, 59, 0.5); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); padding: 20px; border-radius: 15px; margin-bottom: 15px; }
    button { background: #fff; color: #000; border: none; padding: 12px; border-radius: 10px; font-weight: 700; width: 100%; cursor: pointer; }
    .ball { display: inline-block; width: 30px; height: 30px; line-height: 30px; text-align: center; border-radius: 50%; background: #1e293b; margin: 2px; font-size: 13px; font-weight: bold; }
    .ball.hit { background: var(--accent); color: #fff; }
    table { width: 100%; border-collapse: collapse; }
    td { padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05); text-align: center; }
    input { width: 40px; height: 40px; text-align: center; border-radius: 8px; border: 1px solid #334155; background: #000; color: var(--gold); font-weight: bold; }
</style>
</head>
<body>

<div class="card">
    <h2 style="text-align:center; color:var(--accent);">539 æ•¸æ“šåˆ†æçµ‚ç«¯</h2>
    <input type="file" id="csvFile" accept=".csv" style="display:none">
    <label for="csvFile" id="fileLabel" style="display:block; padding:15px; background:rgba(255,255,255,0.05); border-radius:10px; text-align:center; cursor:pointer; margin-bottom:15px;">ğŸ“ é»æ“Šé¸å– history.csv</label>
    <button onclick="run()">å•Ÿå‹•åˆ†æ</button>
</div>

<div id="res" style="display:none">
    <div class="card">
        <h3>ğŸ”¥ æ¨è–¦çµ„åˆ</h3>
        <div id="rec" style="text-align:center"></div>
    </div>
    <div class="card">
        <h3>æ­·å²å‹ç‡é©—è­‰</h3>
        <div style="display:flex; justify-content:center; gap:5px; margin-bottom:10px">
            <input type="number" id="v1"> <input type="number" id="v2"> <input type="number" id="v3"> <input type="number" id="v4"> <input type="number" id="v5">
        </div>
        <button onclick="check()" style="background:transparent; border:1px solid #fff; color:#fff">é©—è­‰è™Ÿç¢¼</button>
        <div id="vRes" style="margin-top:10px; text-align:center"></div>
    </div>
    <div class="card">
        <h3>è¿‘æœŸæ­·å²</h3>
        <div id="hist"></div>
    </div>
</div>

<script>
let DATA = [];

// æ ¸å¿ƒä¿®æ­£ï¼šé©é…æ¨™é¡Œç‚º [é–‹çæ—¥æœŸ,çè™Ÿ1,çè™Ÿ2,çè™Ÿ3,çè™Ÿ4,çè™Ÿ5] çš„æ ¼å¼
function parse(text) {
    const lines = text.trim().split(/\r?\n/).filter(l => l.length > 5);
    lines.shift(); // ç§»é™¤æ¨™é¡Œåˆ—
    return lines.map(l => {
        const p = l.split(',');
        // æŠ“å–æ—¥æœŸ(ç´¢å¼•0)èˆ‡äº”å€‹çè™Ÿ(ç´¢å¼•1~5)
        const nums = p.slice(1, 6).map(n => parseInt(n.trim())).filter(n => !isNaN(n)).sort((a,b)=>a-b);
        return nums.length === 5 ? { date: p[0], nums } : null;
    }).filter(x => x);
}

async function run() {
    const file = document.getElementById('csvFile').files[0];
    if(!file) return;
    DATA = parse(await file.text());
    if(!DATA.length) return alert("è§£æå¤±æ•—ï¼Œè«‹ç¢ºèªæ ¼å¼");
    
    document.getElementById('res').style.display = 'block';
    
    // æ¸²æŸ“æ­·å²
    let h = "<table>";
    DATA.slice(-5).reverse().forEach(d => {
        h += `<tr><td style="font-size:12px;opacity:0.6">${d.date}</td><td>${d.nums.map(n=>`<span class="ball">${n}</span>`).join('')}</td></tr>`;
    });
    document.getElementById('hist').innerHTML = h + "</table>";

    // æ¨è–¦ (ç†±é–€è™Ÿ)
    const f = {};
    DATA.slice(-50).forEach(d => d.nums.forEach(n => f[n] = (f[n]||0)+1));
    const pick = Object.keys(f).sort((a,b)=>f[b]-f[a]).slice(0,5).map(Number).sort((a,b)=>a-b);
    document.getElementById('rec').innerHTML = pick.map(n=>`<span class="ball hit">${n}</span>`).join('');
}

function check() {
    const u = [1,2,3,4,5].map(i=>parseInt(document.getElementById('v'+i).value)).filter(n=>n);
    let s = {2:0, 3:0, 4:0};
    DATA.forEach(d => {
        let m = d.nums.filter(n=>u.includes(n)).length;
        if(m >= 2) s[m >= 4 ? 4 : m]++;
    });
    document.getElementById('vRes').innerHTML = `æ­·å²è¡¨ç¾ï¼š2æ˜Ÿ(${s[2]}æ¬¡) | 3æ˜Ÿ(${s[3]}æ¬¡) | 4æ˜Ÿ+(${s[4]}æ¬¡)`;
}

document.getElementById('csvFile').addEventListener('change', e => {
    document.getElementById('fileLabel').innerText = "å·²é¸å–: " + e.target.files[0].name;
});
</script>
</body>
</html>
